var TodoApp;(()=>{"use strict";var e={369:(e,t)=>{function o(e){for(;e.lastChild;)e.removeChild(e.lastChild)}function n(e,t,n,l,r){console.log(`[MOUNT] Mounting app with root element id: ${l}`);const i=document.getElementById(l);if(!i)throw console.error(`[MOUNT] Element with id "${l}" not found`),new Error(`Element with id "${l}" not found`);const s="todos-elmish_"+l;function a(e){try{const t=JSON.stringify(e);localStorage.setItem(s,t),console.log("[SAVE] Model successfully saved to localStorage:",e)}catch(e){console.error(`[SAVE] Error saving model to localStorage (${s}):`,e)}}function c(e,t,l,r){console.log("[RENDER] Rendering view with model:",e),o(l);const i=n(e,t);console.log("[RENDER] View function result:",i),l.appendChild(i),console.log("[RENDER] View rendered and appended to root"),a(e),r&&(console.log("[RENDER] Scheduling callback"),setTimeout((()=>{console.log("[RENDER] Executing callback"),r()}),0))}let u;function d(e,o){return function(){console.log(`[SIGNAL] Signal called with action: ${e}, data:`,o),console.log("[SIGNAL] Current model before update:",u);try{const n=t(e,u,o);console.log("[SIGNAL] Model updated:",n),i?(u=n,c(u,d,i,(()=>{console.log("[RENDER] DOM updated after action:",e),console.log("[RENDER] Current model after update:",u),a(u)}))):console.error("[SIGNAL] Root element is null, cannot render view")}catch(t){console.error(`[SIGNAL] Error updating model for action: ${e}`,t)}}}console.log(`[MOUNT] Using localStorage key: ${s}`);const T=function(){try{if("undefined"==typeof localStorage)return console.warn("[GET] localStorage is not available"),null;const e=localStorage.getItem(s);if(null===e)return console.log(`[GET] No stored model found for ${s}`),null;const t=JSON.parse(e);return console.log("[GET] Retrieved stored model:",t),t}catch(e){return console.error(`[GET] Error retrieving or parsing model from localStorage (${s}):`,e),null}}();null!==T?(console.log("[INIT] Using stored model from localStorage:",T),u=T):(console.log("[INIT] Using provided initial model:",e),u=e);try{console.log("[INIT] Initial render with model:",u),c(u,d,i),r&&"function"==typeof r?(console.log("[INIT] Initializing subscriptions"),r(d)):console.log("[INIT] No subscriptions provided")}catch(e){throw console.error("[ERROR] Error during mount process:",e),i.innerHTML="<p>An error occurred while mounting the application.</p>",e}return console.log("[MOUNT] Mount process completed, returning signal function"),d}function l(e,t){if(console.log("[ADD_ATTRIBUTES] Processing attributes for node:",t.tagName),console.log("[ADD_ATTRIBUTES] Attribute list:",JSON.stringify(e)),!e||!Array.isArray(e))return console.warn("[ADD_ATTRIBUTES] Invalid attribute list, skipping attribute processing"),t;function o(e){if(!e||"string"!=typeof e)return console.warn(`[ADD_ATTRIBUTES] Invalid attribute name: ${e}, type: ${typeof e}`),!1;const t=e.trim().toLowerCase();if(""===t)return console.warn("[ADD_ATTRIBUTES] Empty attribute name after trimming"),!1;const o=/^[a-z][a-z0-9\-_:]*$/i,n=o.test(t);return n?console.log(`[ADD_ATTRIBUTES] Valid attribute name: "${t}"`):console.warn(`[ADD_ATTRIBUTES] Invalid attribute name: "${t}", does not match regex: ${o}`),n}try{const n=e.map((function(e){if(console.log("[ADD_ATTRIBUTES] Parsing attribute:","function"==typeof e?"Function":e),"function"==typeof e)return console.log("[ADD_ATTRIBUTES] Attribute is a function, treating as event handler"),{key:"event",value:e};if("string"!=typeof e)return console.warn("[ADD_ATTRIBUTES] Invalid attribute type:",typeof e),null;const t=e.trim();if(!t)return console.warn("[ADD_ATTRIBUTES] Empty attribute string after trimming, skipping"),null;const n=t.indexOf("=");if(-1===n){const n=t.toLowerCase();return o(n)?(console.log(`[ADD_ATTRIBUTES] Parsed boolean attribute - key: "${n}"`),{key:n,value:""}):(console.warn(`[ADD_ATTRIBUTES] Invalid boolean attribute name: "${n}", skipping. Full attribute: "${e}"`),null)}const l=t.slice(0,n).trim().toLowerCase(),r=t.slice(n+1).trim();return l?o(l)?""!==r||["class","id","name"].includes(l)?(console.log(`[ADD_ATTRIBUTES] Parsed attribute - key: "${l}", value: "${r}"`),{key:l,value:r}):(console.warn(`[ADD_ATTRIBUTES] Empty attribute value for non-essential attribute: "${l}", skipping. Full attribute: "${e}"`),null):(console.warn(`[ADD_ATTRIBUTES] Invalid attribute name: "${l}", skipping. Full attribute: "${e}"`),null):(console.warn(`[ADD_ATTRIBUTES] Empty attribute name after trimming, skipping. Full attribute: "${e}"`),null)})).filter((e=>null!==e&&""!==e.key));console.log("[ADD_ATTRIBUTES] Parsed attributes:",n),n.forEach(((e,l)=>{var r,i;console.log(`[ADD_ATTRIBUTES] Processing attribute ${l+1}/${n.length}:`,e);try{if("event"===e.key||e.key.startsWith("on")){console.log("[ADD_ATTRIBUTES] Processing event handler");const o="event"===e.key?"click":e.key.slice(2);!function(e,t,o){console.log(`[ADD_ATTRIBUTES] Setting event handler for ${t}`);const n="function"==typeof o?o:e=>{try{const n=o.toString().replace(/^function\s*\([^)]*\)\s*{/,"").replace(/}$/,"").trim();n?new Function("event",n)(e):console.warn(`[ADD_ATTRIBUTES] Empty event handler for ${t}, skipping`)}catch(e){console.error("[ADD_ATTRIBUTES] Error in event handler execution:",e)}};e.addEventListener(t,n),console.log(`[ADD_ATTRIBUTES] Successfully set event handler for ${t}`)}(t,o,e.value)}else{const n=null!==(i=null===(r=e.value)||void 0===r?void 0:r.toString())&&void 0!==i?i:"";!function(e,t,n){console.log(`[ADD_ATTRIBUTES] Attempting to set attribute: key="${t}", value="${n}"`);const l=t.trim().toLowerCase(),r=String(n).trim();if(l&&o(l)){if(["checked","selected","disabled","readonly","multiple","ismap","defer","autofocus","required","hidden"].includes(l))return console.log(`[ADD_ATTRIBUTES] Handling boolean attribute: ${l}`),"true"===r||""===r?e.setAttribute(l,""):e.removeAttribute(l),void console.log(`[ADD_ATTRIBUTES] Boolean attribute ${l} set to ${"true"===r||""===r}`);if(""===r){if(!["class","id","name","value"].includes(l))return void console.warn(`[ADD_ATTRIBUTES] Empty value for non-essential attribute "${l}", skipping`);console.log(`[ADD_ATTRIBUTES] Setting empty value for essential attribute "${l}"`)}try{console.log(`[ADD_ATTRIBUTES] Setting attribute: node=${e.tagName}, key="${l}", value="${r}"`),"class"===l?e.className=r:"style"===l?e.style.cssText=r:e.setAttribute(l,r),console.log(`[ADD_ATTRIBUTES] Successfully set attribute: ${l}="${r}"`)}catch(t){console.error(`[ADD_ATTRIBUTES] Error setting attribute ${l}:`,t),t instanceof DOMException?console.error(`[ADD_ATTRIBUTES] DOMException: ${t.message}`):console.error("[ADD_ATTRIBUTES] Unexpected error:",t),console.error(`[ADD_ATTRIBUTES] Failed attribute details: node=${e.tagName}, key="${l}", value="${r}"`)}}else console.warn(`[ADD_ATTRIBUTES] Invalid attribute name: "${l}", skipping`)}(t,e.key,n)}}catch(t){console.error(`[ADD_ATTRIBUTES] Error processing attribute ${e.key}:`,t),t instanceof DOMException?console.error(`[ADD_ATTRIBUTES] DOMException: ${t.message}`):console.error("[ADD_ATTRIBUTES] Unexpected error:",t)}})),console.log("[ADD_ATTRIBUTES] Finished processing attributes for node:",t.tagName)}catch(e){console.error("[ADD_ATTRIBUTES] Unexpected error in add_attributes function:",e)}return t}function r(e,t){return e&&Array.isArray(e)&&e.length>0&&e.forEach((e=>{t.appendChild(e)})),t}function i(e,t,o){console.log(`[CREATE_ELEMENT] Creating ${e} element`),console.log("[CREATE_ELEMENT] Attributes:",t),console.log("[CREATE_ELEMENT] Number of child nodes:",o.length);const n=r(o,l(t,document.createElement(e)));return console.log("[CREATE_ELEMENT] Element created:",n),n}function s(e,t){return console.log("[SECTION] Creating section with attributes:",e),i("section",e,t)}function a(e,t){return console.log("[A] Creating anchor with attributes:",e),i("a",e,t)}function c(e,t){return console.log("[BUTTON] Creating button with attributes:",e),i("button",e,t)}function u(e,t){return console.log("[DIV] Creating div with attributes:",e),i("div",e,t)}function d(e,t){return console.log("[FOOTER] Creating footer with attributes:",e),i("footer",e,t)}function T(e,t){return console.log("[HEADER] Creating header with attributes:",e),i("header",e,t)}function g(e,t){return console.log("[H1] Creating h1 with attributes:",e),i("h1",e,t)}function E(e,t){return console.log("[INPUT] Creating input with attributes:",e),i("input",e,t)}function f(e,t){return console.log("[LABEL] Creating label with attributes:",e),i("label",e,t)}function p(e,t){return console.log("[LI] Creating li with attributes:",e),i("li",e,t)}function m(e,t){return i("span",e,t)}function A(e){const t=document.createElement("strong");return t.innerHTML=e,t}function b(e){return document.createTextNode(e)}function h(e,t){return i("ul",e,t)}function D(e,t,o){window.location.hash=o;const n=JSON.parse(JSON.stringify(e));return n.hash=o,n}Object.defineProperty(t,"__esModule",{value:!0}),t.empty=o,t.mount=n,t.add_attributes=l,t.append_childnodes=r,t.create_element=i,t.section=s,t.a=a,t.button=c,t.div=u,t.footer=d,t.header=T,t.h1=g,t.input=E,t.label=f,t.li=p,t.span=m,t.strong=A,t.text=b,t.ul=h,t.route=D,e.exports&&(e.exports={add_attributes:l,append_childnodes:r,a,button:c,div:u,empty:o,footer:d,input:E,h1:g,header:T,label:f,li:p,mount:n,route:D,section:s,span:m,strong:A,text:b,ul:h})}},t={};function o(n){var l=t[n];if(void 0!==l)return l.exports;var r=t[n]={exports:{}};return e[n](r,r.exports,o),r.exports}var n={};(()=>{var e=n;Object.defineProperty(e,"__esModule",{value:!0}),e.mount=e.initial_model=void 0,e.update=function e(t,o,n){const l=JSON.parse(JSON.stringify(o));switch(t){case"ADD":const t=o.todos.length>0?o.todos[o.todos.length-1]:null,r=t?t.id+1:1,i=document.getElementById("new-todo");l.todos.push({id:r,title:n||i.value.trim(),done:!1});break;case"TOGGLE":l.todos=l.todos.map((e=>e.id===n?Object.assign(Object.assign({},e),{done:!e.done}):e)),l.all_done=l.todos.every((e=>e.done));break;case"TOGGLE_ALL":l.all_done=!l.all_done,l.todos=l.todos.map((e=>Object.assign(Object.assign({},e),{done:l.all_done})));break;case"DELETE":l.todos=l.todos.filter((e=>e.id!==n));break;case"EDIT":l.clicked===n&&Date.now()-(l.click_time||0)<300?l.editing=n:(l.clicked=n,l.click_time=Date.now(),l.editing=void 0);break;case"SAVE":const s=document.getElementsByClassName("edit")[0],a=s.value,c=parseInt(s.id,10);if(l.clicked=void 0,l.editing=void 0,!a||0===a.length)return e("DELETE",l,c);l.todos=l.todos.map((e=>e.id===c?Object.assign(Object.assign({},e),{title:a.trim()}):e));break;case"CANCEL":l.clicked=void 0,l.editing=void 0;break;case"CLEAR_COMPLETED":l.todos=l.todos.filter((e=>!e.done));break;case"ROUTE":l.hash=window.location.hash;break;default:return o}return l},e.view=function(e,o){return(0,t.section)(["class=todoapp"],[(0,t.header)(["class=header"],[(0,t.h1)([],[(0,t.text)("todos")]),(0,t.input)(["id=new-todo","class=new-todo","placeholder=What needs to be done?","autofocus"],[])]),r(e,o),i(e,o)])},e.subscriptions=function(e){document.addEventListener("keyup",(function(t){switch(t.keyCode){case 13:document.getElementsByClassName("editing").length>0&&e("SAVE")();const t=document.getElementById("new-todo");t.value.length>0&&(e("ADD")(),t.value="",t.focus());break;case 27:e("CANCEL")()}})),window.onhashchange=function(){e("ROUTE")()}},e.render_item=l,e.render_main=r,e.render_footer=i;const t=o(369);function l(e,o,n){if(console.log("[RENDER_ITEM] Rendering item:",JSON.stringify(e)),!e||"object"!=typeof e)return console.error("[RENDER_ITEM] Invalid item:",e),document.createElement("li");const l=e=>{console.log("[FILTER_ATTRIBUTES] Input attributes:",e);const t=e.filter((e=>{if("string"!=typeof e)return console.log("[FILTER_ATTRIBUTES] Filtering out non-string attribute:",e),!1;const[t,...o]=e.split("="),n=o.join("="),l=t.trim().toLowerCase(),r=n.trim();console.log(`[FILTER_ATTRIBUTES] Processing attribute - Key: "${l}", Value: "${r}"`);const i=/^[a-z][a-z0-9\-_:]*$/.test(l);i||console.log(`[FILTER_ATTRIBUTES] Invalid key format: "${l}"`);const s=""!==r||["class","id","name"].includes(l);s||console.log(`[FILTER_ATTRIBUTES] Invalid value for key "${l}": "${r}"`);const a=""!==l&&i&&s;return a?console.log(`[FILTER_ATTRIBUTES] Valid attribute: key="${l}", value="${r}"`):console.log(`[FILTER_ATTRIBUTES] Filtering out invalid attribute: key="${l}", value="${r}"`),a}));return console.log("[FILTER_ATTRIBUTES] Filtered attributes:",t),t},r=l([`data-id=${e.id}`,`id=${e.id}`,e.done?"class=completed":"",o&&o.editing===e.id?"class=editing":""].filter(Boolean)),i=l(["class=toggle","type=checkbox",e.done?"checked=true":""].filter(Boolean));console.log("[RENDER_ITEM] Filtered attributes:",{li:r,input:i});const s=(e,o,n)=>{console.log(`[CREATE_ELEMENT] Creating ${e} with attributes:`,o);const l="li"===e?(0,t.li)(o,n):"div"===e?(0,t.div)(o,n):"input"===e?(0,t.input)(o,n):"label"===e?(0,t.label)(o,n):"button"===e?(0,t.button)(o,n):document.createElement(e);return console.log(`[CREATE_ELEMENT] Created ${e}:`,l),l},a=s("li",r.filter(Boolean),[s("div",["class=view"],[s("input",i.filter(Boolean),[]),s("label",[],[(0,t.text)(e.title||"")]),s("button",["class=destroy"],[])]),...o&&o.editing===e.id?[s("input",l(["class=edit",`id=${e.id}`,`value=${e.title||""}`,"autofocus"]).filter(Boolean),[])]:[]]),c=a.querySelector(".toggle");c?(c.addEventListener("change",(()=>n("TOGGLE",e.id)())),console.log("[EVENT_LISTENER] Attached change listener to toggle element")):console.warn("[EVENT_LISTENER] Toggle element not found");const u=a.querySelector("label");u?(u.addEventListener("dblclick",(()=>n("EDIT",e.id)())),console.log("[EVENT_LISTENER] Attached dblclick listener to label element")):console.warn("[EVENT_LISTENER] Label element not found");const d=a.querySelector(".destroy");return d?(d.addEventListener("click",(()=>n("DELETE",e.id)())),console.log("[EVENT_LISTENER] Attached click listener to destroy button")):console.warn("[EVENT_LISTENER] Destroy button not found"),console.log("[RENDER_ITEM] Created li element:",a),a}function r(e,o){const n="style=display:"+(e.todos.length>0?"block":"none");return(0,t.section)(["class=main","id=main",n],[(0,t.input)(["id=toggle-all","type=checkbox",`onclick=${o("TOGGLE_ALL").toString()}`,e.all_done?"checked=checked":"","class=toggle-all"],[]),(0,t.label)(["for=toggle-all"],[(0,t.text)("Mark all as complete")]),(0,t.ul)(["class=todo-list"],e.todos.length>0?e.todos.filter((t=>{switch(e.hash){case"#/active":return!t.done;case"#/completed":return t.done;default:return!0}})).map((t=>l(t,e,o))):[])])}function i(e,o){const n=e.todos.filter((e=>!e.done)).length,l=e.todos.length-n,r=e.todos.length>0?"block":"none",i=l>0?"block":"none",s=` item${1!==n?"s":""} left`;return(0,t.footer)(["class=footer","id=footer",`style=display:${r}`],[(0,t.span)(["class=todo-count","id=count"],[(0,t.strong)(n.toString()),(0,t.text)(s)]),(0,t.ul)(["class=filters"],[(0,t.li)([],[(0,t.a)(["href=#/","id=all","class="+("#/"===e.hash?"selected":"")],[(0,t.text)("All")])]),(0,t.li)([],[(0,t.a)(["href=#/active","id=active","class="+("#/active"===e.hash?"selected":"")],[(0,t.text)("Active")])]),(0,t.li)([],[(0,t.a)(["href=#/completed","id=completed","class="+("#/completed"===e.hash?"selected":"")],[(0,t.text)("Completed")])])]),(0,t.button)(["class=clear-completed",`style=display:${i}`,o("CLEAR_COMPLETED")],[(0,t.text)("Clear completed ["),(0,t.span)(["id=completed-count"],[(0,t.text)(l.toString())]),(0,t.text)("]")])])}Object.defineProperty(e,"mount",{enumerable:!0,get:function(){return t.mount}}),e.initial_model={todos:[],hash:"#/",all_done:!1}})(),TodoApp=n})();
//# sourceMappingURL=bundle.js.map